# ============================================================================
# RF3 - Interview Question Sets API Collection
# TalentMatchIA - Geração de Perguntas para Entrevistas
# ============================================================================

@baseUrl = http://localhost:4000/api
@token = {{$dotenv AUTH_TOKEN}}

# ============================================================================
# SEÇÃO 1: AUTENTICAÇÃO
# ============================================================================

### 1.1. Login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@talentmatch.com",
  "password": "Admin@123"
}

### 1.2. Obter dados do usuário
GET {{baseUrl}}/user/me
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 2: CRIAR QUESTION SETS (CRUD Básico)
# ============================================================================

### 2.1. Criar conjunto manual com perguntas
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Perguntas Básicas - Desenvolvedor Backend",
  "description": "Conjunto de perguntas técnicas fundamentais para desenvolvedores backend",
  "is_template": true,
  "questions": [
    {
      "type": "technical",
      "text": "Explique o conceito de API RESTful e seus principais verbos HTTP.",
      "order": 1
    },
    {
      "type": "technical",
      "text": "O que é um índice em banco de dados e quando você deve usá-lo?",
      "order": 2
    },
    {
      "type": "behavioral",
      "text": "Conte sobre uma vez que você teve que debugar um problema complexo. Como você abordou?",
      "order": 3
    },
    {
      "type": "situational",
      "text": "Se você tivesse que escolher entre performance e legibilidade de código, o que priorizaria? Por quê?",
      "order": 4
    }
  ]
}

### 2.2. Criar conjunto vazio (para adicionar perguntas depois)
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Perguntas Customizadas - Frontend React",
  "description": "Perguntas específicas para entrevistas de React",
  "is_template": false
}

### 2.3. Criar conjunto via IA (sem currículo)
# NOTA: Requer job_id válido. Substitua pelo ID de uma vaga real.
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "job_id": "SUBSTITUIR_POR_JOB_ID_REAL",
  "title": "Perguntas IA - Desenvolvedor Sênior",
  "description": "Perguntas geradas automaticamente pela IA com base na descrição da vaga",
  "is_template": false,
  "generate_via_ai": true
}

### 2.4. Criar conjunto via IA (com vaga + currículo)
# NOTA: Requer job_id e resume_id válidos
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "job_id": "SUBSTITUIR_POR_JOB_ID_REAL",
  "resume_id": "SUBSTITUIR_POR_RESUME_ID_REAL",
  "title": "Perguntas Personalizadas - João Silva",
  "description": "Perguntas geradas considerando o perfil do candidato e a vaga",
  "is_template": false,
  "generate_via_ai": true
}

### 2.5. Validação: título obrigatório
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "description": "Sem título, deve falhar"
}

### 2.6. Validação: job_id obrigatório para IA
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Teste sem job_id",
  "generate_via_ai": true
}

# ============================================================================
# SEÇÃO 3: LISTAR QUESTION SETS (Filtros e Paginação)
# ============================================================================

### 3.1. Listar todos os conjuntos
GET {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}

### 3.2. Listar com paginação
GET {{baseUrl}}/interview-question-sets?page=1&limit=10
Authorization: Bearer {{token}}

### 3.3. Filtrar por template
GET {{baseUrl}}/interview-question-sets?is_template=true
Authorization: Bearer {{token}}

### 3.4. Filtrar por vaga
# NOTA: Requer job_id válido
GET {{baseUrl}}/interview-question-sets?job_id=SUBSTITUIR_POR_JOB_ID_REAL
Authorization: Bearer {{token}}

### 3.5. Busca por texto (título ou descrição)
GET {{baseUrl}}/interview-question-sets?q=desenvolvedor
Authorization: Bearer {{token}}

### 3.6. Ordenação por data de criação (mais recentes)
GET {{baseUrl}}/interview-question-sets?sort_by=created_at&order=DESC
Authorization: Bearer {{token}}

### 3.7. Ordenação por título (alfabética)
GET {{baseUrl}}/interview-question-sets?sort_by=title&order=ASC
Authorization: Bearer {{token}}

### 3.8. Filtros combinados
GET {{baseUrl}}/interview-question-sets?is_template=true&q=backend&sort_by=created_at&order=DESC&limit=5
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 4: DETALHAMENTO (GET por ID)
# ============================================================================

### 4.1. Obter detalhes completos de um conjunto
# NOTA: Requer set_id válido. Substitua pelo ID retornado na criação.
GET {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 5: ATUALIZAR QUESTION SETS (UPDATE)
# ============================================================================

### 5.1. Atualizar título e descrição
# NOTA: Requer set_id válido
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Perguntas Básicas - Backend (Atualizado)",
  "description": "Descrição atualizada com mais contexto"
}

### 5.2. Tornar conjunto um template
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "is_template": true
}

### 5.3. Atualizar perguntas existentes (editar texto/tipo/ordem)
# NOTA: Requer set_id e question_id válidos
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "questions": [
    {
      "id": "SUBSTITUIR_POR_QUESTION_ID_REAL",
      "text": "Explique o conceito de API RESTful, seus principais verbos HTTP e status codes.",
      "type": "technical",
      "order": 1
    }
  ]
}

### 5.4. Adicionar novas perguntas ao conjunto existente
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "questions": [
    {
      "type": "cultural",
      "text": "Quais valores você considera mais importantes em um ambiente de trabalho?",
      "order": 5
    },
    {
      "type": "general",
      "text": "Por que você está interessado nesta vaga?",
      "order": 6
    }
  ]
}

### 5.5. Update parcial (apenas is_template)
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "is_template": false
}

# ============================================================================
# SEÇÃO 6: DELETAR (Soft Delete)
# ============================================================================

### 6.1. Deletar um conjunto completo
# NOTA: Só deleta perguntas NÃO vinculadas a entrevistas
DELETE {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}

### 6.2. Deletar uma pergunta específica
# NOTA: Requer set_id e question_id válidos. Só funciona se pergunta não usada.
DELETE {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL/questions/SUBSTITUIR_POR_QUESTION_ID_REAL
Authorization: Bearer {{token}}

### 6.3. Tentar deletar conjunto inexistente (deve retornar 404)
DELETE {{baseUrl}}/interview-question-sets/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 7: MÉTRICAS E DASHBOARD
# ============================================================================

### 7.1. Obter métricas consolidadas de question sets
GET {{baseUrl}}/dashboard/question-sets/metrics
Authorization: Bearer {{token}}

### 7.2. Estatísticas de edição (IA vs Manual)
GET {{baseUrl}}/dashboard/question-sets/editing-stats
Authorization: Bearer {{token}}

### 7.3. Conjuntos agrupados por vaga
GET {{baseUrl}}/dashboard/question-sets/by-job
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 8: VALIDAÇÕES E SEGURANÇA
# ============================================================================

### 8.1. Tentar criar sem autenticação (deve retornar 401)
POST {{baseUrl}}/interview-question-sets
Content-Type: application/json

{
  "title": "Sem autorização"
}

### 8.2. Tentar criar com token inválido (deve retornar 401)
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer TOKEN_INVALIDO
Content-Type: application/json

{
  "title": "Token inválido"
}

### 8.3. Tentar acessar question set de outra company (deve retornar 404)
# NOTA: Requer set_id de outra empresa
GET {{baseUrl}}/interview-question-sets/SET_ID_DE_OUTRA_COMPANY
Authorization: Bearer {{token}}

### 8.4. Tentar deletar sem permissão (role != ADMIN/SUPER_ADMIN)
# NOTA: Login com usuário RECRUITER antes de testar
DELETE {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 9: PERFORMANCE E EDGE CASES
# ============================================================================

### 9.1. Listar com limite máximo (100)
GET {{baseUrl}}/interview-question-sets?limit=100
Authorization: Bearer {{token}}

### 9.2. Tentar limite acima do máximo (deve limitar a 100)
GET {{baseUrl}}/interview-question-sets?limit=500
Authorization: Bearer {{token}}

### 9.3. Criar conjunto com muitas perguntas (20+)
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Conjunto Grande - 20 Perguntas",
  "description": "Teste de performance com muitas perguntas",
  "is_template": true,
  "questions": [
    {"type": "technical", "text": "Pergunta 1", "order": 1},
    {"type": "technical", "text": "Pergunta 2", "order": 2},
    {"type": "behavioral", "text": "Pergunta 3", "order": 3},
    {"type": "situational", "text": "Pergunta 4", "order": 4},
    {"type": "cultural", "text": "Pergunta 5", "order": 5},
    {"type": "technical", "text": "Pergunta 6", "order": 6},
    {"type": "technical", "text": "Pergunta 7", "order": 7},
    {"type": "behavioral", "text": "Pergunta 8", "order": 8},
    {"type": "situational", "text": "Pergunta 9", "order": 9},
    {"type": "cultural", "text": "Pergunta 10", "order": 10},
    {"type": "technical", "text": "Pergunta 11", "order": 11},
    {"type": "technical", "text": "Pergunta 12", "order": 12},
    {"type": "behavioral", "text": "Pergunta 13", "order": 13},
    {"type": "situational", "text": "Pergunta 14", "order": 14},
    {"type": "cultural", "text": "Pergunta 15", "order": 15},
    {"type": "technical", "text": "Pergunta 16", "order": 16},
    {"type": "technical", "text": "Pergunta 17", "order": 17},
    {"type": "behavioral", "text": "Pergunta 18", "order": 18},
    {"type": "situational", "text": "Pergunta 19", "order": 19},
    {"type": "general", "text": "Pergunta 20", "order": 20}
  ]
}

### 9.4. Busca com termo vazio (deve retornar todos)
GET {{baseUrl}}/interview-question-sets?q=
Authorization: Bearer {{token}}

### 9.5. Busca com termo inexistente (deve retornar array vazio)
GET {{baseUrl}}/interview-question-sets?q=xyzabc123naoexiste
Authorization: Bearer {{token}}

# ============================================================================
# SEÇÃO 10: FLUXO COMPLETO (E2E)
# ============================================================================

### 10.1. [FLUXO] Passo 1: Criar template de perguntas
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Template - Full Stack Developer",
  "description": "Perguntas padrão para devs full stack",
  "is_template": true,
  "questions": [
    {"type": "technical", "text": "Como você estrutura uma aplicação frontend moderna?", "order": 1},
    {"type": "technical", "text": "Explique o conceito de state management.", "order": 2},
    {"type": "behavioral", "text": "Como você lida com feedback negativo?", "order": 3}
  ]
}

### 10.2. [FLUXO] Passo 2: Listar templates
GET {{baseUrl}}/interview-question-sets?is_template=true
Authorization: Bearer {{token}}

### 10.3. [FLUXO] Passo 3: Duplicar template para uma vaga específica
# NOTA: Usar job_id real
POST {{baseUrl}}/interview-question-sets
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "job_id": "SUBSTITUIR_POR_JOB_ID_REAL",
  "title": "Perguntas - Vaga XYZ (baseado em template)",
  "description": "Adaptado do template Full Stack",
  "is_template": false,
  "questions": [
    {"type": "technical", "text": "Como você estrutura uma aplicação frontend moderna?", "order": 1},
    {"type": "technical", "text": "Explique o conceito de state management.", "order": 2},
    {"type": "behavioral", "text": "Como você lida com feedback negativo?", "order": 3}
  ]
}

### 10.4. [FLUXO] Passo 4: Editar pergunta específica
# NOTA: Usar set_id e question_id do conjunto criado no passo 3
PUT {{baseUrl}}/interview-question-sets/SUBSTITUIR_POR_SET_ID_REAL
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "questions": [
    {
      "id": "SUBSTITUIR_POR_QUESTION_ID_REAL",
      "text": "Como você estrutura uma aplicação React moderna? Fale sobre hooks, context e routing."
    }
  ]
}

### 10.5. [FLUXO] Passo 5: Ver métricas finais
GET {{baseUrl}}/dashboard/question-sets/metrics
Authorization: Bearer {{token}}

# ============================================================================
# FIM DA COLEÇÃO RF3
# Total: 50+ requests
# ============================================================================
