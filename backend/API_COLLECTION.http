###############################################################################
# TalentMatchAI - Complete API Testing Collection
# Use REST Client extension in VS Code or import into Postman
###############################################################################

@baseUrl = http://localhost:4000
@contentType = application/json

### Variables (atualize após cada request)
@access_token = SEU_TOKEN_AQUI
@refresh_token = SEU_REFRESH_TOKEN_AQUI

###############################################################################
# AUTENTICAÇÃO
###############################################################################

### 1. Registrar nova empresa (CPF)
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "type": "CPF",
  "document": "12345678909",
  "name": "João Silva",
  "user": {
    "full_name": "João Silva",
    "email": "joao@example.com",
    "password": "senha123"
  }
}

### 2. Login
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "joao@example.com",
  "senha": "senha123"
}

### 3. Refresh Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refresh_token": "{{refresh_token}}"
}

### 4. Meus dados
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{access_token}}

### 5. Logout
POST {{baseUrl}}/api/auth/logout
Content-Type: {{contentType}}

{
  "refresh_token": "{{refresh_token}}"
}

### 6. Esqueci senha
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: {{contentType}}

{
  "email": "joao@example.com"
}

### 7. Resetar senha
POST {{baseUrl}}/api/auth/reset-password
Content-Type: {{contentType}}

{
  "reset_token": "TOKEN_DO_EMAIL",
  "nova_senha": "novasenha123"
}

### 8. Trocar senha
POST {{baseUrl}}/api/auth/change-password
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "senha_atual": "senha123",
  "nova_senha": "novasenha456"
}

###############################################################################
# DASHBOARD
###############################################################################

### 9. KPIs Dashboard
GET {{baseUrl}}/api/dashboard
Authorization: Bearer {{access_token}}

###############################################################################
# VAGAS
###############################################################################

### 10. Listar vagas
GET {{baseUrl}}/api/jobs
Authorization: Bearer {{access_token}}

### 11. Criar vaga
POST {{baseUrl}}/api/jobs
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "titulo": "Desenvolvedor Full Stack",
  "descricao": "Desenvolvedor experiente em Node.js e React",
  "requisitos": "3+ anos de experiência, TypeScript, SQL",
  "tecnologias": "Node.js, React, PostgreSQL",
  "senioridade": "Pleno",
  "localizacao": "Remoto",
  "tipo_localizacao": "remoto",
  "status": "aberta"
}

### 12. Obter vaga
GET {{baseUrl}}/api/jobs/UUID_AQUI
Authorization: Bearer {{access_token}}

### 13. Atualizar vaga
PUT {{baseUrl}}/api/jobs/UUID_AQUI
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "status": "fechada"
}

### 14. Deletar vaga
DELETE {{baseUrl}}/api/jobs/UUID_AQUI
Authorization: Bearer {{access_token}}

###############################################################################
# CANDIDATOS
###############################################################################

### 15. Listar candidatos
GET {{baseUrl}}/api/candidates
Authorization: Bearer {{access_token}}

### 16. Criar candidato
POST {{baseUrl}}/api/candidates
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "full_name": "Ana Costa",
  "email": "ana@example.com",
  "phone": "+5511999999999",
  "linkedin": "https://linkedin.com/in/anacosta",
  "github_url": "https://github.com/anacosta",
  "skills": ["React", "SQL"]
}

### 16.1 Atualizar candidato
PUT {{baseUrl}}/api/candidates/UUID_AQUI
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "full_name": "Ana C. Costa",
  "skills": ["React", "Node.js"]
}

### 16.2 Deletar candidato
DELETE {{baseUrl}}/api/candidates/UUID_AQUI
Authorization: Bearer {{access_token}}

### 16.3 Listar skills
GET {{baseUrl}}/api/skills
Authorization: Bearer {{access_token}}

###############################################################################
# PIPELINE / APPLICATIONS
###############################################################################

### 17. Obter pipeline de uma vaga (cria padrão se não existir)
GET {{baseUrl}}/api/jobs/{{job_id}}/pipeline
Authorization: Bearer {{access_token}}

### 18. Criar candidatura
POST {{baseUrl}}/api/applications
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "job_id": "{{job_id}}",
  "candidate_id": "{{candidate_id}}"
}

### 19. Listar candidaturas do candidato
GET {{baseUrl}}/api/applications?candidate_id={{candidate_id}}
Authorization: Bearer {{access_token}}

### 20. Mover candidatura para estágio
POST {{baseUrl}}/api/applications/{{application_id}}/move
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "to_stage_id": "{{stage_id}}",
  "note": "Movendo para entrevista"
}

### 21. Histórico de candidatura
GET {{baseUrl}}/api/applications/{{application_id}}/history
Authorization: Bearer {{access_token}}

###############################################################################
# ENTREVISTAS (SCHEDULE)
###############################################################################

### 22. Listar entrevistas (agenda)
GET {{baseUrl}}/api/interviews
Authorization: Bearer {{access_token}}

### 23. Agendar entrevista
POST {{baseUrl}}/api/interviews
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "job_id": "{{job_id}}",
  "candidate_id": "{{candidate_id}}",
  "scheduled_at": "2025-11-20T14:00:00Z",
  "mode": "online"
}

### 24. Atualizar entrevista (status/horário/modo)
PUT {{baseUrl}}/api/interviews/{{interview_id}}
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "status": "completed"
}

### 24.1 Criar sessão de entrevista
POST {{baseUrl}}/api/interviews/{{interview_id}}/session
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "transcript_file_id": null
}

### 25. Gerar feedback de IA
POST {{baseUrl}}/api/interviews/{{interview_id}}/ai-feedback
Authorization: Bearer {{access_token}}

### 26. Listar feedback de IA
GET {{baseUrl}}/api/interviews/{{interview_id}}/ai-feedback
Authorization: Bearer {{access_token}}

### 27. Gerar relatório de entrevista
POST {{baseUrl}}/api/interviews/{{interview_id}}/report
Authorization: Bearer {{access_token}}

### 28. Obter relatório de entrevista
GET {{baseUrl}}/api/interviews/{{interview_id}}/report
Authorization: Bearer {{access_token}}

###############################################################################
# FILES (UPLOAD GENÉRICO)
###############################################################################

### 25. Upload arquivo (multipart/form-data)
# Use uma ferramenta que suporte multipart (REST Client/Insomnia/Postman)
# Campo: file (arquivo), Authorization: Bearer
# POST {{baseUrl}}/api/files


###############################################################################
# ENTREVISTAS
###############################################################################

### 17. Listar entrevistas
GET {{baseUrl}}/api/entrevistas
Authorization: Bearer {{access_token}}

### 18. Criar entrevista
POST {{baseUrl}}/api/entrevistas
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "application_id": "UUID_AQUI",
  "scheduled_at": "2025-11-15T10:00:00Z",
  "mode": "online",
  "status": "agendada"
}

### 19. Gerar perguntas (IA)
POST {{baseUrl}}/api/entrevistas/UUID_AQUI/perguntas
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "qtd": 10
}

### 20. Chat - listar mensagens
GET {{baseUrl}}/api/entrevistas/UUID_AQUI/mensagens
Authorization: Bearer {{access_token}}

### 21. Chat - enviar mensagem
POST {{baseUrl}}/api/entrevistas/UUID_AQUI/chat
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "mensagem": "Qual sua experiência com Node.js?"
}

### 22. Gerar relatório
POST {{baseUrl}}/api/entrevistas/UUID_AQUI/relatorio
Authorization: Bearer {{access_token}}

###############################################################################
# HISTÓRICO
###############################################################################

### 23. Listar histórico
GET {{baseUrl}}/api/historico
Authorization: Bearer {{access_token}}

###############################################################################
# UPLOAD DE CURRÍCULO
###############################################################################

### 24. Upload currículo (use Postman/Insomnia para multipart)
# POST {{baseUrl}}/api/curriculos/upload
# Authorization: Bearer {{access_token}}
# Content-Type: multipart/form-data
# 
# arquivo: [selecionar arquivo PDF/DOCX]
# candidato: {"nome": "João Silva", "email": "joao@example.com"}
# vagaId: UUID_DA_VAGA

###############################################################################
# USUÁRIOS (ADMIN)
###############################################################################

### 25. Listar usuários
GET {{baseUrl}}/api/usuarios
Authorization: Bearer {{access_token}}

### 26. Criar usuário
POST {{baseUrl}}/api/usuarios
Content-Type: {{contentType}}
Authorization: Bearer {{access_token}}

{
  "full_name": "Pedro Oliveira",
  "email": "pedro@empresa.com",
  "password": "senha123",
  "role": "USER"
}

###############################################################################
# HEALTH CHECK
###############################################################################

### 27. Health
GET {{baseUrl}}/
