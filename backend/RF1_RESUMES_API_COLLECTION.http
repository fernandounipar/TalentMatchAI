### ============================================================
### RF1 - Triagem de Currículos - API Collection
### TalentMatchIA - Backend Node.js
### ============================================================

@baseUrl = http://localhost:3001/api
@authToken = {{$processEnv AUTH_TOKEN}}

### 1. LOGIN - Obter token de autenticação
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@empresa.com",
  "password": "senha123"
}

### 2. CREATE - Upload de currículo (via /curriculos/upload)
POST {{baseUrl}}/curriculos/upload
Authorization: Bearer {{authToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="arquivo"; filename="curriculo.pdf"
Content-Type: application/pdf

< ./test-files/curriculo-teste.pdf
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="candidato"

{
  "nome": "Fernando Silva",
  "email": "fernando@example.com",
  "telefone": "+55 48 99999-9999"
}
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="vagaId"

123e4567-e89b-12d3-a456-426614174000
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 3. READ - Listar currículos com paginação
GET {{baseUrl}}/resumes?page=1&limit=20
Authorization: Bearer {{authToken}}

### 4. READ - Listar currículos com filtros
GET {{baseUrl}}/resumes?page=1&limit=10&status=pending&sort_by=created_at&sort_order=DESC
Authorization: Bearer {{authToken}}

### 5. READ - Filtrar por vaga específica
GET {{baseUrl}}/resumes?job_id=123e4567-e89b-12d3-a456-426614174000&page=1&limit=20
Authorization: Bearer {{authToken}}

### 6. READ - Filtrar por nome de candidato
GET {{baseUrl}}/resumes?candidate_name=Fernando&page=1&limit=20
Authorization: Bearer {{authToken}}

### 7. READ - Filtrar por período
GET {{baseUrl}}/resumes?date_from=2025-01-01&date_to=2025-12-31&page=1&limit=20
Authorization: Bearer {{authToken}}

### 8. READ - Obter detalhes de um currículo específico
GET {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}

### 9. UPDATE - Atualizar status do currículo
PUT {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "reviewed",
  "notes": "Candidato com perfil interessante, agendar entrevista"
}

### 10. UPDATE - Marcar como favorito
PUT {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "is_favorite": true
}

### 11. UPDATE - Atualizar vaga vinculada
PUT {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "job_id": "987e4567-e89b-12d3-a456-426614174999"
}

### 12. UPDATE - Múltiplas atualizações
PUT {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "accepted",
  "notes": "Candidato aprovado para próxima fase",
  "is_favorite": true
}

### 13. POST - Reanalisar currículo
POST {{baseUrl}}/resumes/{{resumeId}}/analyze
Authorization: Bearer {{authToken}}

### 14. GET - Buscar currículos por texto
GET {{baseUrl}}/resumes/search?q=JavaScript
Authorization: Bearer {{authToken}}

### 15. DELETE - Excluir currículo (soft delete)
DELETE {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}

### ============================================================
### MÉTRICAS E KPIs (RF1 - David)
### ============================================================

### 16. GET - Métricas gerais do dashboard
GET {{baseUrl}}/dashboard
Authorization: Bearer {{authToken}}

### 17. GET - Métricas detalhadas de currículos
GET {{baseUrl}}/dashboard/resumes/metrics
Authorization: Bearer {{authToken}}

### 18. GET - Timeline de currículos recebidos (últimos 30 dias)
GET {{baseUrl}}/dashboard/resumes/timeline?days=30
Authorization: Bearer {{authToken}}

### 19. GET - Timeline personalizada (últimos 7 dias)
GET {{baseUrl}}/dashboard/resumes/timeline?days=7
Authorization: Bearer {{authToken}}

### ============================================================
### TESTES DE VALIDAÇÃO (RF1 - Iris)
### ============================================================

### 20. VALIDATION - Tentar atualizar sem campos
PUT {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{}

### 21. VALIDATION - Tentar acessar currículo de outra empresa (deve falhar)
GET {{baseUrl}}/resumes/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{authToken}}

### 22. VALIDATION - Paginação com limite alto
GET {{baseUrl}}/resumes?page=1&limit=100
Authorization: Bearer {{authToken}}

### 23. VALIDATION - Ordenação inválida (deve usar padrão)
GET {{baseUrl}}/resumes?sort_by=invalid_field&sort_order=DESC
Authorization: Bearer {{authToken}}

### ============================================================
### TESTES DE PERFORMANCE (RNF1 - tempo < 10s)
### ============================================================

### 24. PERFORMANCE - Upload + Análise (deve completar em < 10s)
# @name uploadAndAnalyze
POST {{baseUrl}}/curriculos/upload
Authorization: Bearer {{authToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="arquivo"; filename="curriculo-performance-test.pdf"
Content-Type: application/pdf

< ./test-files/curriculo-teste.pdf
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="candidato"

{
  "nome": "Teste Performance",
  "email": "perf@test.com"
}
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="vagaId"

123e4567-e89b-12d3-a456-426614174000
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### ============================================================
### TESTES DE SEGURANÇA (RNF3 - LGPD)
### ============================================================

### 25. SECURITY - Verificar mascaramento de e-mail na listagem
GET {{baseUrl}}/resumes?page=1&limit=5
Authorization: Bearer {{authToken}}

### 26. SECURITY - Verificar que dados sensíveis não aparecem em logs
# Conferir logs do servidor após esta requisição
POST {{baseUrl}}/resumes/{{resumeId}}/analyze
Authorization: Bearer {{authToken}}

### ============================================================
### TESTES DE ISOLAMENTO MULTITENANT (company_id)
### ============================================================

### 27. MULTITENANT - Login com usuário de empresa diferente
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "usuario@empresa2.com",
  "password": "senha123"
}

### 28. MULTITENANT - Verificar isolamento de dados
# Após login com empresa2, tentar acessar currículo da empresa1
GET {{baseUrl}}/resumes/{{resumeId}}
Authorization: Bearer {{authToken}}

### ============================================================
### VARIÁVEIS DE TESTE
### ============================================================
# Substitua estes valores com IDs reais do seu banco:
# {{resumeId}} = ID do currículo criado
# {{authToken}} = Token JWT obtido no login
# {{baseUrl}} = http://localhost:3001/api (ou sua URL de produção)
